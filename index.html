<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MERG-CBUSPico-Library: CBUS library for RaspberryPi PICO</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MERG-CBUSPico-Library
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">CBUS library for RaspberryPi PICO </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a> A CBUS Library for the Raspberry PICO, based on the PICO-SDK.</p>
<p>Based on existing MERG Arduino libraries with significant refactoring and clean-up.</p>
<ul>
<li><a href="https://github.com/MERG-DEV/CBUSLED">https://github.com/MERG-DEV/CBUSLED</a></li>
<li><a href="https://github.com/MERG-DEV/CBUSSWITCH">https://github.com/MERG-DEV/CBUSSWITCH</a></li>
<li><a href="https://github.com/MERG-DEV/CBUSConfig">https://github.com/MERG-DEV/CBUSConfig</a></li>
<li><a href="https://github.com/MERG-DEV/CBUS">https://github.com/MERG-DEV/CBUS</a></li>
</ul>
<p>and the PICO CAN2040 libraries:</p>
<ul>
<li><a href="https://github.com/obdevel/ACAN2040">https://github.com/obdevel/ACAN2040</a></li>
<li><a href="https://github.com/obdevel/CBUSACAN2040">https://github.com/obdevel/CBUSACAN2040</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Project Status</h1>
<ul>
<li>Current status has the example module compiling and it appears functional.</li>
<li>Use of the external I2C FRAM or EEPROM is not yet implemented, and is largely untested.</li>
<li>Module based on using the PICO QPSI flash should be functional, but has had very limited testing.</li>
</ul>
<p><b>NOTE:</b> This is a work in progress and all API's and interfaces are therefore subject to change.</p>
<p><b>Build status</b></p>
<p>Github is configured to perform continuous integration builds on every check-in, the latest binaries can be downloaded directly from "Github Actions" without needing to download and build the sources.</p>
<p><img src="https://github.com/kkimber/CBUSPico/actions/workflows/cmake_rpi_pico.yml/badge.svg" alt="git build action status" style="pointer-events: none;" class="inline"/></p>
<p><b>Static code analysis status</b></p>
<p>The code has been analyzed with Coverity for errors.</p>
<p>There are currently zero defects identified in the CBUS library code itself, however there are 22 defects identified in the PICO-SDK code that the CBUS library uses.</p>
<p><a href="https://scan.coverity.com/projects/kkimber-cbuspico"><img src="https://scan.coverity.com/projects/29566/badge.svg" alt="Coverity Scan Build Status" style="pointer-events: none;" class="inline"/> </a></p>
<hr  />
<h1><a class="anchor" id="autotoc_md3"></a>
Building</h1>
<p>CANPico requires the RPi Pico-SDK to be installed and configuration files are provided to build with CMake using the standard setup for a pico-sdk based application.</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>add more build details</dd></dl>
<h1><a class="anchor" id="autotoc_md4"></a>
Documentation</h1>
<p>Full source documentation is provided to be generated with Doxygen:</p>
<p><a href="https://www.doxygen.nl/">https://www.doxygen.nl/</a></p>
<p>To build the documentation make sure you have Doxygen and GraphViz installed and then build the CMake target "doxygen".</p>
<p>The documentation will be created in the build/html folder. Open the file index.html in a browser to view the docs.</p>
<h1><a class="anchor" id="autotoc_md5"></a>
Hardware setup</h1>
<p>The CBUSPico library and examples can be run on any Pico board as long as it is connected to a suitable CAN transceiver, however the default pin mapping has been designed to support the PICO02 board designed by Ian Hart.</p>
<p><img src="pico2.png" alt="" class="inline" title="Pico 2 board"/></p>
<p>The default pin mapping used by CANPico is therefore as follows.</p>
<p><img src="pinout.png" alt="" class="inline" title="pico pin mapping"/></p>
<p>The current configuration of the library uses the PIO based CAN2040 libraries, and therefore the PICO2 should be setup so that the 2515 controller chip is not fitted, and the CAN transceiver is jumpered directly to the PICO.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Storage memory layout</h1>
<p>Storage for module global configuration variables and node variables can optionally be in an external I2C FRAM or EEPROM, or can be located in a the external QSPI flash on the PICO board.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
External FRAM / EEPROM or Flash</h2>
<p>If the external FRAM or EEPROM is used the variables are located offset into the FRAM or EEPROM as per "Address" below.</p>
<p>If QSPI flash is used, the last sector of flash is used. The size of flash on the PICO is defined by PICO_FLASH_SIZE_BYTES, nominally 2MiB in size for current models. Flash sector size is defined as FLASH_SECTOR_SIZE, which is the minimum size that can be erased, so with a flash size of 2MiB the data will be located at 0x1FF000, with variables located within that sector as per "Address" below.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Address #   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Usage   </th><th class="markdownTableHeadNone">EEPROM/FRAM    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x00   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">FLiM Mode   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x01   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">CANID   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x02 - 0x03   </td><td class="markdownTableBodyNone">2   </td><td class="markdownTableBodyNone">Node Number   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x04   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">[spare]   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x05   </td><td class="markdownTableBodyNone">1   </td><td class="markdownTableBodyNone">Reset flag   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x06 - 0x0A   </td><td class="markdownTableBodyNone">4   </td><td class="markdownTableBodyNone">[spare]   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">EE_NVS_START   </td><td class="markdownTableBodyNone">EE_NUM_NVS   </td><td class="markdownTableBodyNone">Node Variables   </td><td class="markdownTableBodyNone">Optional    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">EE_EVENTS_START   </td><td class="markdownTableBodyNone">EE_MAX_EVENTS * (EE_NUM_EVS + 4)   </td><td class="markdownTableBodyNone">Events   </td><td class="markdownTableBodyNone">No   </td></tr>
</table>
<h2><a class="anchor" id="autotoc_md8"></a>
Flash</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Address #   </th><th class="markdownTableHeadNone">Length   </th><th class="markdownTableHeadNone">Usage    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">0x000000 - 0x1FEFFF   </td><td class="markdownTableBodyNone">0x1FF000   </td><td class="markdownTableBodyNone">Application Image    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">0x1FF000 - 0x1FFFFF   </td><td class="markdownTableBodyNone">0x1000   </td><td class="markdownTableBodyNone">Flash Storage   </td></tr>
</table>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
